{% extends "base-with-sidebar.html" %}
{% load comments i18n markup thumbnail %}
{% block css %}
  <link rel="stylesheet" type="text/css"
        href="/media/javascript/jquery.fancybox-1.3.4/jquery.fancybox-1.3.4.css" />
{% endblock %}
{% block javascript %}
  <script type="text/javascript"
          src="/media/javascript/jquery.fancybox-1.3.4/jquery.fancybox-1.3.4.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $("#method img").each(function() {
          $(this).fancybox({"hideOnContentClick": true,
                            "type": "image",
                            "href": this.src,
                            "margin": 14});
      });
    });
  </script>
{% endblock %}

{% block sidebar %}
  {% include "sidebar/sidebar-theory.html" %}
  {% include "sidebar/sidebar-create-method.html" %}
{% endblock %}

{% block main %}
  {% if method.methodbonus_set.all %}
  <a href="{% url methods-show-bonus method.published_at.year method.published_at.month method.published_at.day method.slug %}">
    <img style="float:right;margin-top:-2em;"
         src="/media/images/pedagogic-bonus.png" />
  </a>
  {% endif %}
  <h2>{{ method.title }}</h2>
  <div id="method">
    {{ method.description|markdown:"autolink" }}
  </div>
  <hr />
  {% include "methods-meta.html" %}

  <div id="comments" class="span-18 last">
    {% get_comment_count for method as comment_count %}
    {% get_comment_list for method as comment_list %}
    {% if comment_count %}
    <h2>
      {% blocktrans count comment_count as cc %}
        One comment so far:
        {% plural %}
        {{ cc }} comments:
      {% endblocktrans %}
    </h2>
    {% endif %}

    <ul class="span-18 last" style="padding:0;list-style-type:none;">
      {% for comment in comment_list %}
      <li id="c{{ comment.id }}"
          class="span-18 last{% if comment.last %} comment-last{% endif %}{% ifequal method.user comment.user %} comment-method-owner{% endifequal %}{% if comment.lift_method %} comment-thumbsup{% endif %}"
          style="margin-bottom:1em;">
        <div class="span-1">
              {% if comment.user.get_profile.avatar %}
              <img class="rounded-3" 
                   src="{% thumbnail comment.user.get_profile.avatar 25x25 crop %}"
                   style="border: 2px solid #bbb;float:left;margin-right:0.5em;margin-bottom:0.5em;margin-top:0.5em" />
              {% endif %}
        </div>
        <div class="span-4">
          <div style="padding-top:0.5em;">
            <h3 style="margin-bottom:0.5em;">
              <a href="{% url user comment.user.username %}">{{ comment.user_name }}</a>
            </h3>
            <a class="alt" href="{% get_comment_permalink comment "#c%(id)s" %}" style="font-style:italic;">
              {{ comment.submit_date }}
            </a>
          </div>
        </div>
        <div class="span-13 last">
          <div class="comment-counter">
            {{ forloop.counter }}
          </div>
          <div class="rounded-6 comment-body">
            {% if comment.lift_method %}
            <img style="float:left;margin-right:0.5em;"
                 src="/media/images/icons/001_18.png"
                 width="24" height="24" />
            {% endif %}
            {{ comment.comment|markdown:"autolink" }}
          </div>
        </div>
      </li>
      {% endfor %}
    </ul>

    <h3>{% trans "What are your reflections?" %}</h3>
    <p>{% blocktrans %}
      Try to be constructive and give positive feedback!
    {% endblocktrans %}</p>
    {% get_comment_form for method as form %}
    <form action="{% comment_form_target %}" method="post">
      {% csrf_token %}
      <input type="hidden" name="next"
             value="{% url methods-show-method method.published_at.year method.published_at.month method.published_at.day method.slug %}#comments" />

      {% if not user.is_authenticated %}
      <div class="span-10 append-8 last">
        <div class="span-3">
          {{ form.name.label_tag }}
        </div>
        <div class="span-7 last">
          {{ form.name }}
        </div>
      </div>

      <div class="span-3">
        {{ form.email.label_tag }}
      </div>
      <div class="span-7 append-8 last">
        {{ form.email }}
      </div>

      <div class="span-3">
        {{ form.url.label_tag }}
      </div>
      <div class="span-7 append-8 last">
        {{ form.url }}
      </div>
      {% endif %}

      <div class="span-10 append-8 last">
        <div class="span-10 last">
          {{ form.comment.label_tag }}
        </div>
        <div class="span-10 last">
          {{ form.comment }}
        </div>
      </div>

      <div class="span-10 append-8 last">
        {% blocktrans %}
        With this comment, do you also want to lift this method
        to the top of the methods list?
        {% endblocktrans %}
        {{ form.lift_method }}
      </div>

      {{ form.content_type }}
      {{ form.object_pk }}
      {{ form.timestamp }}
      {{ form.security_hash }}
      <div class="span-18 last">
          <input type="submit" name="submit" class="submit-post" value="Submit">
          <input type="submit" name="preview" class="submit-post" value="Preview">
      </div>
    </form>
  </div>
{% endblock %}
