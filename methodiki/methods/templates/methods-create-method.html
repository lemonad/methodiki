{% extends "base-without-sidebar.html" %}
{% load i18n markup markitup_tags taggit_extras thumbnail %}
{% block css %}
  {% markitup_css %}
  <link href="/media/javascript/fileuploader/fileuploader.css"
        rel="stylesheet" type="text/css" />
  <link href="/media/javascript/jquery-taggit/jquery.taggit.css"
        rel="stylesheet" type="text/css" />
  <link href="/media/javascript/jquery.fancybox-1.3.4/jquery.fancybox-1.3.4.css"
        rel="stylesheet" type="text/css" />
{% endblock %}
{% block javascript %}
  {% markitup_js "no-jquery" %}
  <script type="text/javascript" src="/media/javascript/jquery.timers-1.2.js"></script>
  <script type="text/javascript" src="/media/javascript/jquery-taggit/jquery.taggit.js"></script>
  <script type="text/javascript" src="/media/javascript/jquery.fancybox-1.3.4/jquery.fancybox-1.3.4.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      var suggested_tags = [
        {% comment %}
          {% for title, tags in suggested_tags %}
          {% for tag in tags %}
          "{{ tag }}",
          {% endfor %}
          {% endfor %}
          {% endcomment %}
        ];
      taggit = $("#id_method-tags").taggit({suggested_tags: suggested_tags,
                                            suggested_tags_id: "suggested-tags"});

      $(".qq-upload-button").hover(function() {
         $(this).addClass("qq-upload-button-hover");
      }, function() {
          $(this).removeClass("qq-upload-button-hover");
      });
      $(".qq-upload-button").click(function() {
          $(this).replaceWith("<em>{% trans "Add images after submitting your method (sorry...)" %}</em>");
          $("#file-uploader").delay(5000).hide('slow');
      });
      $("#preview img").each(function() {
          $(this).fancybox({"hideOnContentClick": true,
                            "type": "image",
                            "href": this.src,
                            "margin": 14});
      });
      $("h3.options").click(function() {
          $(this).next().toggle();
          return false;
      });
    });
  </script>
{% endblock %}
{% block main %}
  {% include "methods-preview.html" %}

  <div class="method span-18 prepend-3 append-3 last">
    <h2>{% trans "Start writing!" %}</h2>
    {% include "methods-markdown-quick-help.html" %}
  </div>

  <div class="method span-18 prepend-3 append-3 last">
  <div class="column box rounded-9">
    <form id="method-form" action="{% url methods-create-method %}" method="post">
      {% csrf_token %}
      <div class="span-18 last">
        {{ form.title.label_tag }}
      </div>
      <div class="span-18 last">
        {{ form.title }}
      </div>
      {% if form.title.errors %}
      {% for error in form.title.errors %}
      <p class="error">
        <strong>{{ error|escape }}</strong>
      </p>
      {% endfor %}
      {% endif %}

      <div class="span-18 last">
        {{ form.description.label_tag }}
      </div>
      <div class="span-18 last">
        {{ form.description }}
      </div>
      {% if form.description.errors %}
      <p class="error">
        {{ form.description.errors }}
      </p>
      {% endif %}

      <h2>{% trans "Optional settings" %}</h2>
      <h3 class="span-18 last options rounded-6">
        {% trans "Tags" %}
      </h3>
      <div class="span-18 last" style="display:none;">
        <div class="span-18 last">
          {{ form.tags }}
        </div>
        {% if form.tags.errors %}
        <p class="error">
          {{ form.tags.errors }}
        </p>
        {% endif %}

        <div class="span-18 last tagInputSuggestedTags">
          <span class="label">{% trans "Suggested tags:" %}</span>
          <span id="suggested-tags" class="tagInputSuggestedTagList">
              {% for title, tags in suggested_tags %}
              <br /><strong>{{ title }}:</strong>
              {% for tag in tags %}
              <span class="taggit-tag">{{ tag }}</span>
              {% endfor %}
              {% endfor %}
          </span>
        </div>
      </div>

      <div class="span-18 last" style="text-align:right; margin-bottom:1em;">
        <input class="submit" type="submit" name="preview"
               value="{% trans "Preview" %}" />
        <input class="submit" type="submit" name="method"
               value="{% trans "Create" %}" />
      </div>
    </form>

    <div id="file-uploader" class="span-18 last">
      <div class="qq-uploader">
        <p class="qq-upload-button">
            {% trans "Upload an image" %}
        </p>
      </div>
    </div>
  </div>
  </div>
{% endblock %}